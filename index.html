<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; connect-src 'self' https://api.anthropic.com; font-src https://fonts.gstatic.com;">
<title>Publish ‚Äî Content Automation</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0e0e0e; --surface: #161616; --surface2: #1e1e1e; --surface3: #252525;
  --border: #2c2c2c; --accent: #c8f04a; --accent2: #4af0c8; --accent3: #f0904a;
  --text: #f0ede6; --muted: #666; --muted2: #444;
}
body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
body::after { content:''; position:fixed; inset:0; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E"); pointer-events:none; z-index:9999; }

.app { display:flex; min-height:100vh; }

/* Sidebar */
.sidebar { width:220px; min-height:100vh; background:var(--surface); border-right:1px solid var(--border); padding:28px 16px; display:flex; flex-direction:column; flex-shrink:0; }
.logo { font-family:'Playfair Display',serif; font-size:20px; color:var(--accent); margin-bottom:4px; }
.logo-sub { font-family:'DM Mono',monospace; font-size:10px; color:var(--muted); letter-spacing:1.5px; margin-bottom:28px; }
.nav-section { font-family:'DM Mono',monospace; font-size:10px; letter-spacing:1.5px; color:var(--muted2); padding:14px 10px 6px; text-transform:uppercase; }
.nav-item { display:flex; align-items:center; gap:9px; padding:9px 10px; border-radius:7px; cursor:pointer; font-size:13px; color:var(--muted); transition:all .15s; }
.nav-item:hover { background:var(--surface2); color:var(--text); }
.nav-item.active { background:var(--surface2); color:var(--accent); }
.nav-item svg { width:15px; height:15px; flex-shrink:0; opacity:.8; }
.nav-divider { height:1px; background:var(--border); margin:10px 0; }
.int-badge { display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:7px; font-size:12px; color:var(--muted); border:1px solid var(--border); margin-top:4px; cursor:pointer; transition:all .15s; }
.int-badge:hover { border-color:var(--accent); color:var(--accent); }
.int-badge .dot { width:6px; height:6px; border-radius:50%; background:var(--muted2); flex-shrink:0; }
.int-badge.on .dot { background:var(--accent); }
.csoon { font-size:9px; font-family:'DM Mono',monospace; background:var(--surface3); border:1px solid var(--border); border-radius:3px; padding:1px 5px; color:var(--muted2); margin-left:auto; }

/* Main */
.main { flex:1; display:flex; flex-direction:column; min-width:0; }
.topbar { height:58px; border-bottom:1px solid var(--border); display:flex; align-items:center; padding:0 28px; gap:14px; background:var(--surface); flex-shrink:0; }
.topbar h1 { font-family:'Playfair Display',serif; font-size:19px; font-weight:400; }
.topbar-actions { margin-left:auto; display:flex; gap:8px; }

/* Buttons */
.btn { padding:8px 15px; border-radius:6px; font-size:12.5px; font-family:'DM Sans',sans-serif; cursor:pointer; border:1px solid var(--border); background:var(--surface2); color:var(--text); transition:all .15s; font-weight:500; display:inline-flex; align-items:center; gap:6px; white-space:nowrap; }
.btn:hover { border-color:var(--accent); color:var(--accent); }
.btn.primary { background:var(--accent); color:#0e0e0e; border-color:var(--accent); font-weight:600; }
.btn.primary:hover { background:#d4f55a; }
.btn.ghost { background:transparent; border-color:transparent; color:var(--muted); }
.btn.ghost:hover { color:var(--text); border-color:var(--border); }
.btn:disabled { opacity:.35; cursor:not-allowed; pointer-events:none; }

/* Views */
.view { padding:28px; flex:1; display:none; }
.view.active { display:block; animation:fadeUp .22s ease; }
@keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

/* Empty state */
.empty-hero { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:80px 20px; text-align:center; gap:14px; }
.empty-hero .ering { width:68px; height:68px; border-radius:50%; border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:26px; background:var(--surface2); }
.empty-hero h2 { font-family:'Playfair Display',serif; font-size:22px; font-weight:400; }
.empty-hero p { font-size:13.5px; color:var(--muted); max-width:360px; line-height:1.65; }
.empty-hero .eacts { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:6px; }

/* Stats */
.stats-bar { display:flex; gap:1px; margin-bottom:22px; background:var(--border); border-radius:10px; overflow:hidden; border:1px solid var(--border); }
.stat { flex:1; background:var(--surface); padding:14px 18px; text-align:center; }
.stat .val { font-family:'Playfair Display',serif; font-size:24px; }
.stat .lbl { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); margin-top:2px; }

/* Article list */
.articles-grid { display:flex; flex-direction:column; gap:1px; background:var(--border); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
.article-row { background:var(--surface); padding:15px 20px; display:flex; align-items:center; gap:14px; cursor:pointer; transition:background .12s; }
.article-row:hover { background:var(--surface2); }
.title-block { flex:1; min-width:0; }
.art-title { font-size:14px; font-weight:500; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.art-meta { font-size:11.5px; color:var(--muted); font-family:'DM Mono',monospace; margin-top:2px; }
.sdot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
.sdot.draft { background:var(--muted2); }
.sdot.ready { background:var(--accent); box-shadow:0 0 6px rgba(200,240,74,.4); }
.sdot.scheduled { background:var(--accent2); }
.sdot.published { background:#7ee87e; }
.pchips { display:flex; gap:4px; flex-shrink:0; }
.pchip { font-size:10px; font-family:'DM Mono',monospace; font-weight:600; padding:3px 7px; border-radius:4px; }
.pchip.li { background:rgba(10,102,194,.18); color:#5aadff; border:1px solid rgba(10,102,194,.3); }
.pchip.tw { background:rgba(29,155,240,.18); color:#5ac8ff; border:1px solid rgba(29,155,240,.3); }
.spill { display:inline-flex; align-items:center; gap:5px; padding:3px 9px; border-radius:20px; font-size:11px; font-family:'DM Mono',monospace; flex-shrink:0; }
.spill.draft { background:rgba(100,100,100,.12); color:var(--muted); border:1px solid var(--border); }
.spill.ready { background:rgba(200,240,74,.1); color:var(--accent); border:1px solid rgba(200,240,74,.2); }
.spill.scheduled { background:rgba(74,240,200,.1); color:var(--accent2); border:1px solid rgba(74,240,200,.2); }
.spill.published { background:rgba(126,232,126,.1); color:#7ee87e; border:1px solid rgba(126,232,126,.2); }
.row-acts { display:flex; gap:3px; flex-shrink:0; }
.ibtn { width:28px; height:28px; border-radius:5px; background:transparent; border:1px solid transparent; cursor:pointer; display:flex; align-items:center; justify-content:center; color:var(--muted); transition:all .12s; font-size:13px; }
.ibtn:hover { background:var(--surface3); border-color:var(--border); color:var(--text); }
.ibtn.del:hover { color:#f06a4a; border-color:rgba(240,106,74,.25); }

/* Overlays */
.overlay { position:fixed; inset:0; background:rgba(0,0,0,.78); display:flex; align-items:center; justify-content:center; z-index:200; opacity:0; pointer-events:none; transition:opacity .2s; padding:20px; }
.overlay.open { opacity:1; pointer-events:all; }
.modal { background:var(--surface); border:1px solid var(--border); border-radius:14px; width:100%; max-width:660px; max-height:88vh; overflow-y:auto; transform:translateY(16px); transition:transform .2s; }
.overlay.open .modal { transform:translateY(0); }
.modal.wide { max-width:780px; }
.mhead { padding:22px 26px 0; display:flex; align-items:flex-start; gap:14px; }
.mhead .info { flex:1; }
.mhead h2 { font-family:'Playfair Display',serif; font-size:20px; font-weight:400; line-height:1.3; }
.mhead .msub { font-size:12px; color:var(--muted); font-family:'DM Mono',monospace; margin-top:4px; }
.mclose { width:30px; height:30px; border-radius:6px; background:var(--surface2); border:1px solid var(--border); cursor:pointer; display:flex; align-items:center; justify-content:center; color:var(--muted); font-size:17px; flex-shrink:0; transition:color .12s; }
.mclose:hover { color:var(--text); }
.mbody { padding:22px 26px; }
.mfoot { padding:14px 26px 22px; display:flex; align-items:center; gap:8px; border-top:1px solid var(--border); }

/* Forms */
.fg { display:flex; flex-direction:column; gap:6px; margin-bottom:16px; }
.fg:last-child { margin-bottom:0; }
.fl { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); letter-spacing:.5px; text-transform:uppercase; }
.fi, .fta, .fsel { background:var(--surface2); border:1px solid var(--border); border-radius:7px; padding:10px 13px; color:var(--text); font-size:13.5px; font-family:'DM Sans',sans-serif; transition:border-color .15s; width:100%; outline:none; }
.fi:focus, .fta:focus, .fsel:focus { border-color:var(--accent); }
.fi::placeholder, .fta::placeholder { color:var(--muted2); }
.fta { resize:vertical; min-height:180px; line-height:1.65; }
.frow { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.fnote { font-size:11.5px; color:var(--muted); line-height:1.5; margin-top:2px; }

/* Generate UI */
.gtabs { display:flex; gap:6px; margin-bottom:16px; }
.gtab { padding:8px 15px; border-radius:6px; cursor:pointer; font-size:13px; font-weight:500; border:1px solid var(--border); background:var(--surface2); color:var(--muted); transition:all .15s; display:flex; align-items:center; gap:6px; }
.gtab.active.li { background:rgba(10,102,194,.18); color:#5aadff; border-color:rgba(10,102,194,.4); }
.gtab.active.tw { background:rgba(29,155,240,.18); color:#5ac8ff; border-color:rgba(29,155,240,.4); }
.cbox { background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:16px; position:relative; }
.cbox textarea { width:100%; background:transparent; border:none; color:var(--text); font-size:13.5px; font-family:'DM Sans',sans-serif; resize:none; min-height:180px; line-height:1.7; outline:none; }
.cc { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); text-align:right; margin-top:6px; }
.cc.warn { color:#f0b44a; } .cc.over { color:#f06a4a; }
.tweet-list { display:flex; flex-direction:column; gap:7px; }
.tcard { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:12px; }
.tnum { font-size:10px; font-family:'DM Mono',monospace; color:var(--muted); margin-bottom:4px; }
.tcard textarea { width:100%; background:transparent; border:none; color:var(--text); font-size:13px; font-family:'DM Sans',sans-serif; resize:none; outline:none; line-height:1.6; }
.tcc { font-size:10px; font-family:'DM Mono',monospace; color:var(--muted); text-align:right; margin-top:2px; }
.tcc.over { color:#f06a4a; }
.hintbar { font-size:12px; color:var(--muted); margin-top:10px; line-height:1.5; padding:9px 12px; background:var(--surface2); border-radius:6px; border-left:2px solid var(--border); }
.spinrow { display:flex; align-items:center; justify-content:center; gap:10px; padding:44px 0; font-size:13px; color:var(--muted); font-family:'DM Mono',monospace; }
.spin { width:16px; height:16px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:sp .7s linear infinite; }
@keyframes sp { to{transform:rotate(360deg)} }
.srow { display:flex; align-items:center; gap:10px; margin-bottom:14px; flex-wrap:wrap; }
.slbl { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); text-transform:uppercase; white-space:nowrap; }
input[type="datetime-local"] { background:var(--surface2); border:1px solid var(--border); border-radius:6px; padding:7px 10px; color:var(--text); font-family:'DM Mono',monospace; font-size:12px; outline:none; }
input[type="datetime-local"]:focus { border-color:var(--accent2); }

/* Integrations */
.int-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.icard { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px; transition:border-color .15s; }
.icard:hover { border-color:var(--muted2); }
.icard.on { border-color:rgba(200,240,74,.3); }
.iico { width:38px; height:38px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:17px; margin-bottom:12px; }
.icard h3 { font-size:14px; font-weight:500; margin-bottom:3px; }
.icard p { font-size:12px; color:var(--muted); line-height:1.55; margin-bottom:12px; }
.ist { font-size:11px; font-family:'DM Mono',monospace; display:flex; align-items:center; gap:5px; margin-bottom:10px; }
.ist .dot { width:6px; height:6px; border-radius:50%; }
.ist.on { color:var(--accent); } .ist.on .dot { background:var(--accent); }
.ist.off { color:var(--muted2); } .ist.off .dot { background:var(--muted2); }
.kbanner { background:linear-gradient(135deg,#141f09,#0e1809); border:1px solid rgba(200,240,74,.18); border-radius:10px; padding:16px 18px; margin-bottom:20px; display:flex; gap:12px; align-items:flex-start; }
.kbanner .ki { font-size:20px; flex-shrink:0; }
.kbanner h4 { font-size:13.5px; font-weight:500; color:var(--accent); margin-bottom:3px; }
.kbanner p { font-size:12px; color:var(--muted); line-height:1.55; }

/* Toast */
.toast { position:fixed; bottom:22px; right:22px; background:var(--surface); border:1px solid var(--accent); border-radius:8px; padding:11px 16px; font-size:13px; font-family:'DM Mono',monospace; color:var(--accent); z-index:9999; transform:translateY(70px); opacity:0; transition:all .25s; pointer-events:none; }
.toast.show { transform:translateY(0); opacity:1; }
.toast.err { border-color:#f06a4a; color:#f06a4a; }

::-webkit-scrollbar { width:5px; } ::-webkit-scrollbar-track { background:transparent; } ::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
</style>
</head>
<body>
<div class="app">

<nav class="sidebar">
  <div class="logo">Publish</div>
  <div class="logo-sub">CONTENT OS</div>

  <div class="nav-item active" id="nav-queue" onclick="showView('queue',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
    Article Queue
  </div>
  <div class="nav-item" id="nav-scheduled" onclick="showView('scheduled',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    Scheduled
  </div>
  <div class="nav-item" id="nav-published" onclick="showView('published',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
    Published
  </div>

  <div class="nav-divider"></div>
  <div class="nav-section">Integrations</div>

  <div class="int-badge" id="claude-badge" onclick="showView('integrations',null)">
    <div class="dot" id="claude-dot"></div>Claude API
  </div>
  <div class="int-badge" onclick="showView('integrations',null)">
    <div class="dot"></div>Notion <span class="csoon">soon</span>
  </div>
  <div class="int-badge" onclick="showView('integrations',null)">
    <div class="dot"></div>Google Sheets <span class="csoon">soon</span>
  </div>
  <div class="int-badge" onclick="showView('integrations',null)">
    <div class="dot"></div>LinkedIn <span class="csoon">soon</span>
  </div>
  <div class="int-badge" onclick="showView('integrations',null)">
    <div class="dot"></div>Twitter / X <span class="csoon">soon</span>
  </div>
</nav>

<div class="main">
  <div class="topbar">
    <h1 id="view-title">Article Queue</h1>
    <div class="topbar-actions" id="topbar-actions">
      <button class="btn primary" onclick="openAddModal()">+ Add Article</button>
    </div>
  </div>

  <!-- Queue -->
  <div class="view active" id="view-queue">
    <div class="stats-bar">
      <div class="stat"><div class="val" id="s-total">0</div><div class="lbl">TOTAL</div></div>
      <div class="stat"><div class="val" id="s-ready">0</div><div class="lbl">READY</div></div>
      <div class="stat"><div class="val" id="s-sched">0</div><div class="lbl">SCHEDULED</div></div>
      <div class="stat"><div class="val" id="s-pub">0</div><div class="lbl">PUBLISHED</div></div>
    </div>
    <div id="queue-body"></div>
  </div>

  <!-- Scheduled -->
  <div class="view" id="view-scheduled"><div id="sched-body"></div></div>

  <!-- Published -->
  <div class="view" id="view-published"><div id="pub-body"></div></div>

  <!-- Integrations -->
  <div class="view" id="view-integrations">
    <div class="kbanner">
      <div class="ki">‚ú¶</div>
      <div>
        <h4>Claude API Key</h4>
        <p>Required to generate LinkedIn posts and Twitter threads from your articles. Get yours free at <strong>console.anthropic.com</strong> ‚Äî you pay only per use (a few cents per article).</p>
      </div>
    </div>
    <div class="fg" style="margin-bottom:12px">
      <label class="fl">Claude API Key</label>
      <input type="password" class="fi" id="claude-key-input" placeholder="sk-ant-..." />
      <div class="fnote">Stored in your browser only. Never sent anywhere except Anthropic's API.</div>
    </div>
    <div style="margin-bottom:32px"><button class="btn primary" onclick="saveClaudeKey()">Save Key</button></div>

    <div class="int-grid">
      <div class="icard"><div class="iico" style="background:rgba(10,102,194,.15)">üíº</div><h3>LinkedIn</h3><p>Auto-post generated content to your LinkedIn profile on schedule.</p><div class="ist off"><div class="dot"></div>Coming soon</div><button class="btn" disabled>Connect</button></div>
      <div class="icard"><div class="iico" style="background:rgba(29,155,240,.15)">ùïè</div><h3>Twitter / X</h3><p>Post full threads automatically. Requires Twitter API Basic tier for write access.</p><div class="ist off"><div class="dot"></div>Coming soon</div><button class="btn" disabled>Connect</button></div>
      <div class="icard"><div class="iico" style="background:rgba(255,255,255,.06)">‚óª</div><h3>Notion</h3><p>Sync articles directly from your Notion workspace pages.</p><div class="ist off"><div class="dot"></div>Coming soon</div><button class="btn" disabled>Connect</button></div>
      <div class="icard"><div class="iico" style="background:rgba(52,168,83,.15)">üìä</div><h3>Google Sheets</h3><p>Use a spreadsheet as your content calendar with title, content and schedule columns.</p><div class="ist off"><div class="dot"></div>Coming soon</div><button class="btn" disabled>Connect</button></div>
    </div>
  </div>
</div>
</div>

<!-- Add Modal -->
<div class="overlay" id="ov-add">
  <div class="modal">
    <div class="mhead">
      <div class="info"><h2>Add Article</h2><div class="msub">Paste your article ‚Äî Claude handles the rest</div></div>
      <button class="mclose" onclick="closeOv('ov-add')">√ó</button>
    </div>
    <div class="mbody">
      <div class="fg"><label class="fl">Title</label><input type="text" class="fi" id="add-title" placeholder="Article title..." /></div>
      <div class="fg">
        <label class="fl">Article Content</label>
        <textarea class="fta" id="add-content" style="min-height:220px" placeholder="Paste your full article text here...&#10;&#10;The more you give Claude, the better the output."></textarea>
      </div>
      <div class="frow">
        <div class="fg"><label class="fl">Status</label><select class="fsel" id="add-status"><option value="ready">Ready to Post</option><option value="draft">Draft</option></select></div>
        <div class="fg"><label class="fl">Platforms</label><select class="fsel" id="add-plats"><option value="both">LinkedIn + Twitter</option><option value="li">LinkedIn only</option><option value="tw">Twitter only</option></select></div>
      </div>
    </div>
    <div class="mfoot">
      <button class="btn primary" onclick="addArticle()">Add to Queue</button>
      <button class="btn ghost" onclick="closeOv('ov-add')">Cancel</button>
    </div>
  </div>
</div>

<!-- Generate Modal -->
<div class="overlay" id="ov-gen">
  <div class="modal wide">
    <div class="mhead">
      <div class="info"><h2 id="gen-title">‚Äî</h2><div class="msub" id="gen-sub">‚Äî</div></div>
      <button class="mclose" onclick="closeOv('ov-gen')">√ó</button>
    </div>
    <div class="mbody">
      <div class="gtabs">
        <div class="gtab active li" id="gt-li" onclick="switchTab('li')"><span style="font-weight:700;font-size:11px">in</span> LinkedIn Post</div>
        <div class="gtab tw" id="gt-tw" onclick="switchTab('tw')"><span style="font-weight:700;font-size:11px">ùïè</span> Twitter Thread</div>
      </div>

      <div id="panel-li">
        <div class="srow"><span class="slbl">Schedule</span><input type="datetime-local" id="sched-li"><button class="btn" style="padding:6px 10px;font-size:12px" onclick="setNow('li')">Now</button></div>
        <div class="cbox">
          <div class="spinrow" id="li-spin" style="display:none"><div class="spin"></div>Generating LinkedIn post‚Ä¶</div>
          <textarea id="li-text" placeholder="Click Generate to create a LinkedIn post from your article‚Ä¶" oninput="updateCC()"></textarea>
          <div class="cc" id="li-cc">0 chars</div>
        </div>
        <div class="hintbar">üí° Best results: strong hook, 3‚Äì5 insights in short paragraphs, end with a question. ~900‚Äì1200 chars.</div>
      </div>

      <div id="panel-tw" style="display:none">
        <div class="srow"><span class="slbl">Schedule</span><input type="datetime-local" id="sched-tw"><button class="btn" style="padding:6px 10px;font-size:12px" onclick="setNow('tw')">Now</button></div>
        <div class="spinrow" id="tw-spin" style="display:none"><div class="spin"></div>Generating Twitter thread‚Ä¶</div>
        <div class="tweet-list" id="tw-list"></div>
        <div class="hintbar" style="margin-top:10px">üí° Threads: hook ‚Üí insights ‚Üí CTA. Every tweet must be ‚â§ 280 chars.</div>
      </div>
    </div>
    <div class="mfoot">
      <button class="btn primary" id="gen-btn" onclick="generate()">‚ú¶ Generate with Claude</button>
      <button class="btn" onclick="schedPost()">Schedule Post</button>
      <button class="btn ghost" style="margin-left:auto" onclick="copyContent()">Copy</button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="overlay" id="ov-edit">
  <div class="modal">
    <div class="mhead">
      <div class="info"><h2>Edit Article</h2></div>
      <button class="mclose" onclick="closeOv('ov-edit')">√ó</button>
    </div>
    <div class="mbody">
      <div class="fg"><label class="fl">Title</label><input type="text" class="fi" id="edit-title"></div>
      <div class="fg"><label class="fl">Content</label><textarea class="fta" id="edit-content" style="min-height:200px"></textarea></div>
      <div class="frow">
        <div class="fg"><label class="fl">Status</label><select class="fsel" id="edit-status"><option value="draft">Draft</option><option value="ready">Ready to Post</option><option value="scheduled">Scheduled</option><option value="published">Published</option></select></div>
        <div class="fg"><label class="fl">Platforms</label><select class="fsel" id="edit-plats"><option value="both">LinkedIn + Twitter</option><option value="li">LinkedIn only</option><option value="tw">Twitter only</option></select></div>
      </div>
    </div>
    <div class="mfoot">
      <button class="btn primary" onclick="saveEdit()">Save</button>
      <button class="btn ghost" onclick="closeOv('ov-edit')">Cancel</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let articles = JSON.parse(localStorage.getItem('pub_v2') || '[]');
let claudeKey = localStorage.getItem('pub_ck') || '';
let curArt = null;
let curTab = 'li';
let editId = null;

window.onload = () => {
  if (claudeKey) {
    document.getElementById('claude-key-input').value = claudeKey;
    document.getElementById('claude-dot').style.background = 'var(--accent)';
    document.getElementById('claude-badge').classList.add('on');
  }
  renderAll();
};

function showView(name, navEl) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (navEl) navEl.classList.add('active');
  const titles = {queue:'Article Queue', scheduled:'Scheduled', published:'Published', integrations:'Integrations'};
  document.getElementById('view-title').textContent = titles[name] || '';
  document.getElementById('topbar-actions').innerHTML = name === 'queue'
    ? `<button class="btn primary" onclick="openAddModal()">+ Add Article</button>` : '';
  if (name === 'scheduled') renderFiltered('scheduled', 'sched-body', 'üïê', 'No scheduled articles yet', 'Schedule articles from the queue.');
  if (name === 'published') renderFiltered('published', 'pub-body', '‚úÖ', 'No published articles yet', "Mark articles as published once you've posted them.");
}

function renderAll() { renderQueue(); updateStats(); }

function updateStats() {
  document.getElementById('s-total').textContent = articles.length;
  document.getElementById('s-ready').textContent = articles.filter(a=>a.status==='ready').length;
  document.getElementById('s-sched').textContent = articles.filter(a=>a.status==='scheduled').length;
  document.getElementById('s-pub').textContent = articles.filter(a=>a.status==='published').length;
}

function renderQueue() {
  updateStats();
  const el = document.getElementById('queue-body');
  if (!articles.length) {
    el.innerHTML = `<div class="empty-hero">
      <div class="ering">‚úçÔ∏è</div>
      <h2>Your queue is empty</h2>
      <p>Add your first article by pasting in the content. Claude will adapt it into a LinkedIn post and Twitter thread.</p>
      <div class="eacts">
        <button class="btn primary" onclick="openAddModal()">+ Add Article</button>
        <button class="btn" onclick="showView('integrations',null)">Integrations ‚Üí</button>
      </div>
    </div>`; return;
  }
  el.innerHTML = `<div class="articles-grid">${articles.map(aRow).join('')}</div>`;
}

function renderFiltered(status, elId, icon, title, desc) {
  const el = document.getElementById(elId);
  const f = articles.filter(a => a.status === status);
  if (!f.length) { el.innerHTML = `<div class="empty-hero"><div class="ering">${icon}</div><h2>${title}</h2><p>${desc}</p></div>`; return; }
  el.innerHTML = `<div class="articles-grid">${f.map(aRow).join('')}</div>`;
}

function aRow(a) {
  const chips = [
    a.platforms !== 'tw' ? `<span class="pchip li">LI</span>` : '',
    a.platforms !== 'li' ? `<span class="pchip tw">ùïè</span>` : ''
  ].join('');
  const words = a.content ? a.content.trim().split(/\s+/).length : 0;
  const rt = words > 0 ? `~${Math.ceil(words/200)} min read` : 'no content yet';
  const generated = (a.liPost || (a.twThread && a.twThread.length)) ? ' ¬∑ adapted ‚ú¶' : '';
  return `<div class="article-row" onclick="openGenModal(${a.id})">
    <div class="sdot ${a.status}"></div>
    <div class="title-block">
      <div class="art-title">${esc(a.title)}</div>
      <div class="art-meta">${rt}${generated}</div>
    </div>
    <div class="pchips">${chips}</div>
    <span class="spill ${a.status}">${a.status}</span>
    <div class="row-acts" onclick="event.stopPropagation()">
      <button class="ibtn" title="Edit" onclick="openEditModal(${a.id})">‚úé</button>
      <button class="ibtn del" title="Delete" onclick="delArticle(${a.id})">√ó</button>
    </div>
  </div>`;
}

// Add
function openAddModal() { openOv('ov-add'); }
function addArticle() {
  const title = document.getElementById('add-title').value.trim();
  if (!title) { toast('Please enter a title', true); return; }
  articles.unshift({
    id: Date.now(),
    title,
    content: document.getElementById('add-content').value.trim(),
    status: document.getElementById('add-status').value,
    platforms: document.getElementById('add-plats').value,
    addedAt: new Date().toISOString(),
    liPost: '', twThread: [], scheduledLi: '', scheduledTw: ''
  });
  save(); renderQueue(); closeOv('ov-add');
  document.getElementById('add-title').value = '';
  document.getElementById('add-content').value = '';
  toast('‚úì Added to queue');
}

// Edit
function openEditModal(id) {
  const a = articles.find(x=>x.id===id); if (!a) return;
  editId = id;
  document.getElementById('edit-title').value = a.title;
  document.getElementById('edit-content').value = a.content || '';
  document.getElementById('edit-status').value = a.status;
  document.getElementById('edit-plats').value = a.platforms;
  openOv('ov-edit');
}
function saveEdit() {
  const a = articles.find(x=>x.id===editId); if (!a) return;
  a.title = document.getElementById('edit-title').value.trim();
  a.content = document.getElementById('edit-content').value.trim();
  a.status = document.getElementById('edit-status').value;
  a.platforms = document.getElementById('edit-plats').value;
  save(); renderAll(); closeOv('ov-edit'); toast('‚úì Saved');
}
function delArticle(id) {
  articles = articles.filter(a=>a.id!==id);
  save(); renderAll(); toast('Removed');
}

// Generate modal
function openGenModal(id) {
  const a = articles.find(x=>x.id===id); if (!a) return;
  curArt = a;
  document.getElementById('gen-title').textContent = a.title;
  const w = a.content ? a.content.trim().split(/\s+/).length : 0;
  document.getElementById('gen-sub').textContent = w ? `${w.toLocaleString()} words ¬∑ click Generate to adapt for each platform` : 'No content ‚Äî edit this article to add content first';
  document.getElementById('li-text').value = a.liPost || '';
  updateCC();
  renderTweets(a.twThread || []);
  switchTab('li');
  openOv('ov-gen');
}

function switchTab(t) {
  curTab = t;
  document.getElementById('panel-li').style.display = t==='li'?'block':'none';
  document.getElementById('panel-tw').style.display = t==='tw'?'block':'none';
  document.getElementById('gt-li').className = `gtab ${t==='li'?'active li':''}`;
  document.getElementById('gt-tw').className = `gtab ${t==='tw'?'active tw':''}`;
}

function updateCC() {
  const n = document.getElementById('li-text').value.length;
  const el = document.getElementById('li-cc');
  el.textContent = `${n.toLocaleString()} chars`;
  el.className = `cc ${n>3000?'over':n>1300?'warn':''}`;
}

function renderTweets(tweets) {
  const el = document.getElementById('tw-list');
  if (!tweets.length) {
    el.innerHTML = `<div class="cbox"><textarea style="width:100%;background:transparent;border:none;color:var(--text);font-size:13.5px;font-family:'DM Sans',sans-serif;resize:none;min-height:130px;outline:none;line-height:1.7" placeholder="Click Generate to create a Twitter thread‚Ä¶"></textarea></div>`;
    return;
  }
  el.innerHTML = tweets.map((t,i) => `<div class="tcard">
    <div class="tnum">${i+1} / ${tweets.length}</div>
    <textarea rows="${Math.max(2,Math.ceil(t.length/62))}" onkeyup="updateTCC(this,${i})">${esc(t)}</textarea>
    <div class="tcc ${t.length>280?'over':''}" id="tcc-${i}">${t.length}/280</div>
  </div>`).join('');
}
function updateTCC(el,i) {
  const c = document.getElementById('tcc-'+i);
  c.textContent=`${el.value.length}/280`; c.className=`tcc ${el.value.length>280?'over':''}`;
}

async function generate() {
  if (!claudeKey) { toast('Add your Claude API key in Integrations first', true); return; }
  if (!curArt?.content) { toast('This article has no content ‚Äî edit it to add text first', true); return; }

  const btn = document.getElementById('gen-btn');
  btn.disabled = true; btn.textContent = '‚ú¶ Generating‚Ä¶';

  if (curTab === 'li') {
    document.getElementById('li-spin').style.display = 'flex';
    document.getElementById('li-text').style.opacity = '.3';

    const prompt = `You are a LinkedIn content strategist. Transform this article into a compelling LinkedIn post.

Requirements:
- Open with a powerful hook ‚Äî first line must stop the scroll
- 900‚Äì1200 characters total
- 3‚Äì5 key insights in short paragraphs (1‚Äì2 sentences each)
- End with a thought-provoking question or clear CTA
- First person, conversational but professional
- Flowing prose only ‚Äî no bullet points
- Max 3 hashtags on their own line at the very end
- No emojis

Article title: ${curArt.title}
Article content:
${curArt.content.slice(0,5000)}

Return ONLY the post text. Nothing else.`;

    try {
      const text = await claude(prompt);
      document.getElementById('li-text').value = text;
      updateCC();
      curArt.liPost = text; saveArt(curArt); toast('‚úì LinkedIn post generated');
    } catch(e) { toast('Error: '+e.message, true); }
    finally { document.getElementById('li-spin').style.display='none'; document.getElementById('li-text').style.opacity='1'; }

  } else {
    document.getElementById('tw-spin').style.display = 'flex';
    document.getElementById('tw-list').style.opacity = '.3';

    const prompt = `You are a Twitter/X content strategist. Transform this article into an engaging thread.

Requirements:
- 6‚Äì10 tweets total
- Every tweet MUST be under 280 characters ‚Äî count carefully before writing each one
- Tweet 1: Powerful hook + "üßµ" at end + numbered "1/"
- Tweets 2‚Äì(n-1): One clear insight each, numbered
- Final tweet: CTA (follow for more, or read the full article), numbered
- Conversational tone
- No bullet points within tweets

Article title: ${curArt.title}
Article content:
${curArt.content.slice(0,5000)}

Respond with ONLY a valid JSON array of strings. No markdown, no extra text. Example:
["First tweet text 1/", "Second tweet 2/"]`;

    try {
      const raw = await claude(prompt);
      const tweets = JSON.parse(raw.replace(/```json|```/g,'').trim());
      renderTweets(tweets);
      curArt.twThread = tweets; saveArt(curArt); toast('‚úì Twitter thread generated');
    } catch(e) { toast('Error: '+e.message, true); }
    finally { document.getElementById('tw-spin').style.display='none'; document.getElementById('tw-list').style.opacity='1'; }
  }

  btn.disabled=false; btn.textContent='‚ú¶ Generate with Claude';
}

async function claude(prompt) {
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key':claudeKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
    body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1200,messages:[{role:'user',content:prompt}]})
  });
  const d = await res.json();
  if (d.error) throw new Error(d.error.message);
  return d.content[0].text;
}

function setNow(p) {
  const d = new Date(); d.setMinutes(d.getMinutes()-d.getTimezoneOffset());
  document.getElementById('sched-'+p).value = d.toISOString().slice(0,16);
}

function schedPost() {
  const v = document.getElementById('sched-'+curTab).value;
  if (!v) { toast('Set a date/time first', true); return; }
  if (curTab==='li') curArt.scheduledLi = v; else curArt.scheduledTw = v;
  curArt.status = 'scheduled';
  saveArt(curArt); renderAll();
  toast(`‚úì Scheduled for ${new Date(v).toLocaleString()}`);
}

function copyContent() {
  const text = curTab==='li'
    ? document.getElementById('li-text').value
    : Array.from(document.querySelectorAll('#tw-list textarea')).map(t=>t.value).join('\n\n');
  if (!text) { toast('Generate content first', true); return; }
  navigator.clipboard.writeText(text).then(()=>toast('‚úì Copied to clipboard'));
}

function saveClaudeKey() {
  claudeKey = document.getElementById('claude-key-input').value.trim();
  localStorage.setItem('pub_ck', claudeKey);
  const hasDot = document.getElementById('claude-dot');
  hasDot.style.background = claudeKey ? 'var(--accent)' : 'var(--muted2)';
  document.getElementById('claude-badge').classList.toggle('on', !!claudeKey);
  toast(claudeKey ? '‚úì Claude API key saved' : 'Key removed');
}

function openOv(id) { document.getElementById(id).classList.add('open'); }
function closeOv(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.overlay').forEach(o => o.addEventListener('click', e => { if(e.target===o) o.classList.remove('open'); }));

function saveArt(a) {
  const i = articles.findIndex(x=>x.id===a.id);
  if (i>-1) articles[i]=a; else articles.unshift(a);
  save();
}
function save() { localStorage.setItem('pub_v2',JSON.stringify(articles)); updateStats(); }
function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function toast(msg, err=false) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast${err?' err':''} show`;
  setTimeout(()=>t.classList.remove('show'),3000);
}
</script>
</body>
</html>
